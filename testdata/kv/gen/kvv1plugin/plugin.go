// Code generated by protoc-gen-connect-plugin. DO NOT EDIT.

// source: kv.proto

package kvv1plugin

import (
	"fmt"
	"net/http"

	"connectrpc.com/connect"
	connectplugin "github.com/masegraye/connect-plugin-go"
	kvv1connect "github.com/masegraye/connect-plugin-go/testdata/kv/gen/kvv1connect"
)

// KVServicePlugin implements connectplugin.Plugin for KVService.
type KVServicePlugin struct{}

var _ connectplugin.Plugin = (*KVServicePlugin)(nil)

// Metadata returns plugin metadata.
func (p *KVServicePlugin) Metadata() connectplugin.PluginMetadata {
	return connectplugin.PluginMetadata{
		Name:    "kv",
		Path:    kvv1connect.KVServiceName,
		Version: "1.0.0",
		Provides: []connectplugin.ServiceDeclaration{
			{
				Type:    "kv",
				Version: "1.0.0",
				Path:    kvv1connect.KVServiceName,
			},
		},
	}
}

// ConnectServer creates a server-side handler for this plugin.
func (p *KVServicePlugin) ConnectServer(impl any) (string, http.Handler, error) {
	handler, ok := impl.(kvv1connect.KVServiceHandler)
	if !ok {
		return "", nil, fmt.Errorf("impl must implement KVServiceHandler, got %T", impl)
	}

	path, h := kvv1connect.NewKVServiceHandler(handler)
	return path, h, nil
}

// ConnectClient creates a client-side plugin instance.
func (p *KVServicePlugin) ConnectClient(baseURL string, httpClient connect.HTTPClient) (any, error) {
	return kvv1connect.NewKVServiceClient(httpClient, baseURL), nil
}
