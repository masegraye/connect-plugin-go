// Code generated by protoc-gen-connect-plugin. DO NOT EDIT.

// source: capability/logger/v1/logger.proto

package loggerv1delegate

import (
	"context"
	"net/http"

	"connectrpc.com/connect"
	loggerv1 "github.com/masegraye/connect-plugin-go/gen/capability/logger/v1"
	loggerv1connect "github.com/masegraye/connect-plugin-go/gen/capability/logger/v1/loggerv1connect"
)

// Ensure imports are used
var _ = connect.IsAtLeastVersion1_13_0

// Logger is the domain interface for Logger.
type Logger interface {
	// Log writes a log entry.
	Log(ctx context.Context, level string, message string, fields map[string]string) error
}

// loggerDelegate implements Logger using a Connect client.
type loggerDelegate struct {
	client loggerv1connect.LoggerClient
}

var _ Logger = (*loggerDelegate)(nil)

// New creates a Logger from an existing Connect client.
func New(client loggerv1connect.LoggerClient) Logger {
	return &loggerDelegate{client: client}
}

// NewFromURL creates a Logger from a URL.
func NewFromURL(url string, opts ...connect.ClientOption) Logger {
	client := loggerv1connect.NewLoggerClient(http.DefaultClient, url, opts...)
	return &loggerDelegate{client: client}
}

// Log implements Log via Connect client.
func (d *loggerDelegate) Log(ctx context.Context, level string, message string, fields map[string]string) error {
	req := &loggerv1.LogRequest{
		Level:   level,
		Message: message,
		Fields:  fields,
	}

	_, err := d.client.Log(ctx, connect.NewRequest(req))
	if err != nil {
		return err
	}

	return nil
}
